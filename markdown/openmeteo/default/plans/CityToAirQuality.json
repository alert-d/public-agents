{
    "description": "Convert a city name to coordinates and get current air quality data with major pollutants and air quality indices.",
    "type": "plan",
    "version": "v0.0.1",
    "agent": "openmeteo/airquality",
    "serial": [
        {
            "description": "Geocode the city name to get coordinates",
            "type": "fetch",
            "method": "GET",
            "url": "https://geocoding-api.open-meteo.com/v1/search",
            "params": {
                "name": "Berlin",
                "count": "1",
                "language": "en",
                "format": "json"
            },
            "stream": true,
            "name": "geocodingResults"
        },
        {
            "description": "Get air quality data using the coordinates",
            "type": "fetch",
            "method": "GET",
            "url": "https://air-quality-api.open-meteo.com/v1/air-quality",
            "params": {
                "latitude": "${$geocodingResults.results[0].latitude}",
                "longitude": "${$geocodingResults.results[0].longitude}",
                "current": "pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,ozone,sulphur_dioxide,european_aqi,us_aqi",
                "hourly": "pm10,pm2_5,carbon_monoxide,nitrogen_dioxide,ozone,sulphur_dioxide,european_aqi,us_aqi",
                "forecast_days": "5",
                "timezone": "${$geocodingResults.results[0].timezone}",
                "domains": "auto"
            },
            "stream": true,
            "name": "airQualityData"
        },
        {
            "description": "Display current air quality data in table format",
            "type": "table",
            "title": "Current Air Quality Data",
            "stream": false,
            "name": "airQualityTable",
            "input": "${[{\"location\": $geocodingResults.results[0].name, \"latitude\": $airQualityData.latitude, \"longitude\": $airQualityData.longitude, \"current_pm10\": $airQualityData.current.pm10, \"current_pm2_5\": $airQualityData.current.pm2_5, \"current_carbon_monoxide\": $airQualityData.current.carbon_monoxide, \"current_nitrogen_dioxide\": $airQualityData.current.nitrogen_dioxide, \"current_ozone\": $airQualityData.current.ozone, \"current_sulphur_dioxide\": $airQualityData.current.sulphur_dioxide, \"current_european_aqi\": $airQualityData.current.european_aqi, \"current_us_aqi\": $airQualityData.current.us_aqi, \"timezone\": $airQualityData.timezone}]}"
        },
        {
            "description": "Analyze air quality data and provide insights",
            "model": "gpt-4",
            "type": "llm",
            "stream": true,
            "input": "${$airQualityTable}",
            "query": "Analyze the air quality data for this location. Provide insights about current air quality conditions, health implications, and recommendations for outdoor activities. Include interpretation of both European and US Air Quality Indices."
        }
    ]
}
