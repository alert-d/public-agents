{
    "description": "Convert a city name to coordinates and get historical weather data for analysis",
    "type": "plan",
    "version": "v0.0.1",
    "agent": "openmeteo/historical",
    "serial": [
        {
            "description": "Geocode the city name to get coordinates",
            "type": "fetch",
            "method": "GET",
            "url": "https://geocoding-api.open-meteo.com/v1/search",
            "params": {
                "name": "New York",
                "count": "1",
                "language": "en",
                "format": "json"
            },
            "stream": true,
            "name": "geocodingResults"
        },
        {
            "description": "Get historical weather data for the specified period",
            "type": "fetch",
            "method": "GET",
            "url": "https://archive-api.open-meteo.com/v1/archive",
            "params": {
                "latitude": "${$geocodingResults.results[0].latitude}",
                "longitude": "${$geocodingResults.results[0].longitude}",
                "start_date": "2023-01-01",
                "end_date": "2023-12-31",
                "daily": "temperature_2m_max,temperature_2m_min,precipitation_sum,weather_code",
                "timezone": "${$geocodingResults.results[0].timezone}"
            },
            "stream": true,
            "name": "historicalData"
        },
        {
            "description": "Display daily historical weather data in table format",
            "type": "table",
            "title": "Daily Historical Weather Data",
            "stream": false,
            "name": "historicalTable",
            "input": "${$zip($historicalData.daily.time, $historicalData.daily.temperature_2m_max, $historicalData.daily.temperature_2m_min, $historicalData.daily.precipitation_sum, $historicalData.daily.weather_code) ~> $map(function($row) { {\"date\": $row[0], \"temperature_2m_max\": $row[1], \"temperature_2m_min\": $row[2], \"precipitation_sum\": $row[3], \"weather_code\": $row[4]} })}"
        },
        {
            "description": "Analyze historical weather data and provide insights",
            "model": "gpt-4",
            "type": "llm",
            "stream": true,
            "input": "${$historicalTable}",
            "query": "Analyze the historical weather data for ${$transformHistorical.location} during ${$transformHistorical.period}. Key statistics: Max temp: ${$transformHistorical.max_temperature}°C, Min temp: ${$transformHistorical.min_temperature}°C, Average temp: ${$transformHistorical.avg_temperature}°C, Total precipitation: ${$transformHistorical.total_precipitation}mm over ${$transformHistorical.data_points} days. Provide insights about: 1) Temperature patterns and extremes, 2) Precipitation trends, 3) Seasonal variations, 4) Notable weather events. Include specific data points, averages, and practical observations about the weather patterns."
        }
    ]
}
